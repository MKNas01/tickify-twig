<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tickets - Tickify</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Tickets.css - Exact copy from React */
    .tickets-page-container {
      display: flex;
      height: 100vh;
      background-color: #F9FAFB;
    }

    .app-wrapper {
      max-width: 1440px;
      margin: 0 auto;
      padding: 0 20px;
      width: 100%;
      flex: 1;
    }

    .tickets-main {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
      word-break: break-word;
    }

    h2 {
      text-align: center;
      margin-bottom: 1.5rem;
      color: #1E40AF;
      font-size: clamp(1.25rem, 3vw, 1.5rem);
    }

    .ticket-form {
      background: #FFFFFF;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .form-group {
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: 600;
      margin-bottom: 0.4rem;
      color: #0F172A;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 0.6rem;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 1rem;
      outline-color: #60A5FA;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .error {
      color: #dc2626;
      font-size: 0.85rem;
      margin-top: 0.25rem;
      display: block;
    }

    .submit-btn {
      background: #3B82F6;
      color: #FFFFFF;
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
      width: 100%;
      font-weight: 500;
    }

    .submit-btn:hover:not(:disabled) {
      background: #1E40AF;
    }

    .submit-btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
      opacity: 0.7;
    }

    /* Tickets List */
    .tickets-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .tickets-list h3 {
      font-size: 1.25rem;
      color: #0F172A;
      margin-bottom: 1rem;
    }

    .ticket-card {
      background: #FFFFFF;
      padding: 1.25rem;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      position: relative;
      transition: transform 0.2s ease;
      display: flex;
      flex-direction: column;
    }

    .ticket-card:hover {
      transform: translateY(-2px);
    }

    .ticket-card h4 {
      margin-bottom: 0.5rem;
      color: #3B82F6;
      font-weight: 600;
    }

    .ticket-card p {
      color: #64748B;
      margin-bottom: 1rem;
    }

    .status-tag {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: capitalize;
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      color: #FFFFFF;
    }

    .ticket-card.open .status-tag {
      background-color: #16a34a; /* Green */
    }

    .ticket-card.in_progress .status-tag {
      background-color: #f59e0b; /* Amber */
    }

    .ticket-card.closed .status-tag {
      background-color: #6b7280; /* Gray */
    }

    .card-actions {
      margin-top: auto; /* Push to bottom */
      display: flex;
      gap: 0.5rem;
      padding-top: 1rem;
      border-top: 1px solid #e5e7eb;
    }

    .edit-btn,
    .delete-btn {
      flex: 1;
      padding: 0.5rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: background 0.2s ease;
    }

    .edit-btn {
      background: #60A5FA;
      color: #FFFFFF;
    }

    .edit-btn:hover {
      background: #3B82F6;
    }

    .delete-btn {
      background: #ef4444;
      color: #FFFFFF;
    }

    .delete-btn:hover {
      background: #dc2626;
    }

    .no-tickets {
      text-align: center;
      color: #64748B;
      font-style: italic;
    }

    /* Mobile/Tablet (<=900px) */
    .menu-toggle {
      display: none;
      background: #3B82F6;
      color: #FFFFFF;
      border: none;
      padding: 0.5rem 0.7rem;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 1rem;
      z-index: 50;
    }

    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 30;
      cursor: pointer;
    }

    @media (max-width: 900px) {
      .app-wrapper {
        padding: 0 15px;
      }

      .menu-toggle {
        display: block;
        position: fixed;
        top: 1rem;
        left: 1rem;
        z-index: 60;
      }

      .overlay {
        display: block;
      }

      .tickets-main {
        padding: 5rem 1.5rem 2rem;
      }

      .ticket-form {
        padding: 1.25rem;
      }

      .tickets-list {
        gap: 1rem;
      }

      .card-actions {
        flex-direction: column;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: -260px;
        width: 250px;
        height: 100vh;
        background-color: #FFFFFF;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.06);
        transition: left 0.3s ease;
        z-index: 100;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .sidebar.open {
        left: 0;
      }

      .sidebar-content {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        padding-top: 1rem;
        flex-grow: 1;
      }

      .sidebar-close {
        display: flex;
        justify-content: flex-end;
        padding: 1rem;
        cursor: pointer;
      }
    }

    @media (max-width: 480px) {
      .tickets-main {
        padding: 4.5rem 1rem 1.5rem;
      }

      .ticket-form {
        padding: 1rem;
      }

      .ticket-card {
        padding: 1rem;
      }

      h2, .tickets-list h3 {
        font-size: 1.1rem;
      }
    }

    /* Desktop (>900px): Offset main, 2-col form, 3-col tickets */
    @media (min-width: 901px) {
      .menu-toggle {
        display: none;
      }

      .overlay {
        display: none;
      }

      .tickets-main {
        margin-left: 250px;
        padding: 2.5rem;
        max-width: calc(100% - 250px);
      }

      .app-wrapper {
        padding: 0 30px;
      }

      /* Form: Inline labels on desktop */
      .form-group {
        flex-direction: row;
        align-items: center;
        gap: 1rem;
      }

      label {
        flex: 0 0 120px; /* Fixed label width */
        text-align: right;
        margin-bottom: 0;
      }

      input, textarea, select {
        flex: 1;
      }

      .submit-btn {
        width: auto;
        max-width: 200px;
        align-self: flex-end;
      }

      /* Tickets: 3-col grid */
      .tickets-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 1.5rem;
      }

      .ticket-card {
        height: 100%; /* Equal height in grid */
      }

      .card-actions {
        flex-direction: row;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 250px;
        height: 100vh;
        background-color: #FFFFFF;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.06);
        z-index: 50;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
      }

      .sidebar-close {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="tickets-page-container">
    {% include 'sidebar.twig' %}

    <!-- Overlay -->
    <div class="overlay" onclick="toggleSidebar()"></div>

    <!-- Main content -->
    <div class="app-wrapper">
      <main class="tickets-main">
        <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Toggle sidebar">
          <span class="menu-icon">â˜°</span>
        </button>

        <h2>ðŸŽ« Manage Tickets</h2>

        <form method="POST" action="/tickets" class="ticket-form">
          <input type="hidden" name="action" value="{{ edit_mode ? 'update' : 'create' }}" />
          {% if edit_mode %}
            <input type="hidden" name="id" value="{{ edit_ticket.id }}" />
          {% endif %}

          {% if error %}
            <div class="error global-error">{{ error }}</div>
          {% endif %}

          <div class="form-group">
            <label for="title">Title *</label>
            <input
              type="text"
              id="title"
              name="title"
              value="{{ form.title ?? '' }}"
              placeholder="Enter ticket title"
              required
              aria-describedby="title-error"
            />
            <span id="title-error" class="error">{{ title_error ?? '' }}</span>
          </div>

          <div class="form-group">
            <label for="description">Description</label>
            <textarea
              id="description"
              name="description"
              placeholder="Enter ticket description (min 10 chars if provided)"
              rows="4"
              aria-describedby="desc-error"
            >{{ form.description ?? '' }}</textarea>
            <span id="desc-error" class="error">{{ description_error ?? '' }}</span>
          </div>

          <div class="form-group">
            <label for="status">Status *</label>
            <select id="status" name="status" required aria-describedby="status-error">
              <option value="open" {{ (form.status ?? 'open') == 'open' ? 'selected' : '' }}>Open</option>
              <option value="in_progress" {{ form.status == 'in_progress' ? 'selected' : '' }}>In Progress</option>
              <option value="closed" {{ form.status == 'closed' ? 'selected' : '' }}>Closed</option>
            </select>
            <span id="status-error" class="error">{{ status_error ?? '' }}</span>
          </div>

          <button type="submit" class="submit-btn">
            {{ edit_mode ? 'Update Ticket' : 'Create Ticket' }}
          </button>
        </form>

        <div class="tickets-list">
          <h3>All Tickets</h3>
          {% if tickets|length == 0 %}
            <p class="no-tickets">No tickets available</p>
          {% else %}
            {% for ticket in tickets %}
              <div class="ticket-card {{ ticket.status }}">
                <h4>{{ ticket.title }}</h4>
                <p>{{ ticket.description ?: 'No description provided' }}</p>
                <span class="status-tag" aria-label="Status: {{ ticket.status }}">
                  {{ ticket.status|replace({'_': ' '})|title }}
                </span>
                <div class="card-actions">
                  <a href="/tickets?edit={{ ticket.id }}" class="edit-btn">Edit</a>
                  <form method="POST" action="/tickets" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this ticket?');">
                    <input type="hidden" name="action" value="delete" />
                    <input type="hidden" name="id" value="{{ ticket.id }}" />
                    <button type="submit" class="delete-btn">Delete</button>
                  </form>
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </main>
    </div>
  </div>

  <script>
    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.querySelector('.overlay');
      sidebar.classList.toggle('open');
      overlay.style.display = sidebar.classList.contains('open') ? 'block' : 'none';
    }
  </script>
</body>
</html>